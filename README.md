![image](https://github.com/user-attachments/assets/934fa337-49e8-4c3c-b82d-23fd6de1ae3e)
![image](https://github.com/user-attachments/assets/056b0250-4e15-444b-930e-34a08147d302)
![image](https://github.com/user-attachments/assets/5d916790-288e-464f-972b-b2ea5587dbe2)
![image](https://github.com/user-attachments/assets/5d5d9bc1-d436-4336-8934-7d13daa2004a)
![image](https://github.com/user-attachments/assets/9876d356-a91c-474b-a29e-d924bb20b24d)
***局域网文件传输助手网页版***
简介
局域网文件传输助手网页版是一个借助 Flask 框架搭建的 Web 应用与 PyQt5 构建的客户端图形界面配合使用的工具，旨在方便局域网内进行文件传输以及查看服务器相关状态，同时辅助设备连接操作，为局域网内的文件交互提供便利。
功能
文件上传功能：
用户可通过客户端指定的界面操作（如选择文件保存路径等），在网页端向服务器发起文件上传请求（通过/upload接口），支持一次上传多个文件。服务器会根据配置文件中设定的上传路径来保存文件，并返回相应的上传结果提示信息，告知用户文件是否上传成功以及出现的具体问题（如果有）。
另外，有/api/get-upload-url接口方便客户端获取准确的文件上传 URL，便于客户端进行相应的上传操作配置。
服务器状态查看功能：
客户端能够定时（每 3 秒）以异步方式获取服务器的实时状态信息，包括上行速率、下行速率、已连接的设备信息以及服务器的运行状态（启动 / 停止）等，并在客户端图形界面上更新展示，方便用户直观了解服务器当前的工作情况。
服务器端通过后台线程持续统计网络相关数据（上传和下载字节数，并计算出速率），在/status接口将这些状态数据以 JSON 格式提供给客户端。
设备连接辅助功能：
在客户端的设备连接窗口中，会显示本地访问地址（固定为http://127.0.0.1:5000）以及服务器的 IP 地址（自动尝试获取），每个地址都配备 “复制” 按钮方便用户复制使用。若成功获取到 IP 地址，还会生成对应的二维码展示在窗口中，便于局域网内的其他设备通过扫码等方式连接到服务器进行文件传输等操作。
文件保存路径管理功能：
客户端提供了对文件保存路径的管理功能，可从配置文件中读取已保存的路径并在下拉框中展示（最多保存 5 条路径），通过 “浏览” 按钮能新增保存路径，“查看文件夹” 按钮可打开当前选中路径对应的文件夹，同时还能将选中的路径设置为上传路径保存到配置文件中，方便用户灵活管理文件存储位置。
组成部分
服务器端（基于 Flask 框架）：
路由与接口处理部分：包含/upload用于处理文件上传逻辑、/api/get-upload-url用于提供上传 URL、/status用于反馈服务器状态以及/（根路径，渲染网页页面）和/favicon.ico（处理网站图标请求）等路由，各个路由对应不同的功能函数来处理具体的业务逻辑。
后台线程部分：通过NetworkStatsThread类创建的后台线程，负责持续获取和更新网络统计信息（如上传和下载速率），为服务器状态数据提供实时的网络相关指标。
配置文件读取部分：使用configparser模块读取config.ini配置文件，从中获取如文件上传路径等相关配置信息，用于服务器端的各项功能操作，比如确定文件该保存到何处等。
客户端（基于 PyQt5 框架）：
主窗口部分（ServerManagerApp类）：是整个客户端的核心界面，集成了服务器控制按钮（启动 / 停止服务器）、服务器状态显示标签（运行状态、时长、速率、设备信息等）、文件保存路径管理相关组件（路径选择下拉框、浏览、查看文件夹等按钮）以及打开设备连接窗口的按钮等，通过信号与槽机制以及定时器等实现与服务器的交互和界面更新。
设备连接窗口部分（DeviceConnectionWindow类）：以对话框形式呈现，包含显示本地访问地址和服务器 IP 地址（含复制按钮）以及生成展示二维码（在获取到有效 IP 地址时）等功能组件，辅助局域网内设备连接到服务器进行文件传输等操作。
服务器端
（Flask 应用部分）
文件上传功能：
定义了/upload接口，能接收客户端发来的文件（通过POST请求，文件字段名为files[]），会先从配置文件config.ini中获取指定的上传路径，若路径不存在则创建，然后尝试逐个保存上传的文件，并根据文件保存的实际情况（全部成功、部分成功有错误、全部失败）返回不同状态码和相应提示信息的 JSON 格式响应，方便客户端知晓上传结果。
还有/api/get-upload-url接口，用于向客户端返回/upload接口对应的完整外部 URL，方便客户端能准确地向服务器发起文件上传请求。
服务器状态反馈功能：
通过创建一个后台线程NetworkStatsThread，利用psutil模块持续获取网络的上传和下载字节数，并定期（每秒）计算上传和下载速率。在/status接口中，除了返回固定的示例设备连接信息（如"connected_devices"列表）和日志信息（如"log_messages"列表）外，还会将实时计算得到的上传和下载速率数据以 JSON 格式返回给客户端，方便客户端了解服务器的网络相关状态。若出现异常情况，会返回包含错误信息的 JSON 数据以及500状态码。
页面展示功能：
根路径/对应的index函数会渲染index.html页面（不过代码中没展示index.html的具体内容），用于向用户呈现一些相关的前端界面内容。
还有/favicon.ico接口，用于正确返回网站的图标文件，确保浏览器能正常显示网站的图标。
客户端（PyQt5 图形界面部分）
主窗口（ServerManagerApp类）：
界面上有用于控制服务器启动和停止的按钮，点击按钮能调用ServerManager类的相关方法来实际操作服务器进程（启动或停止），并且会根据服务器的不同运行状态更新界面上按钮的文本、样式以及显示服务器状态、运行时长等相关标签的内容。
可以通过定时器定期（每 3 秒）以异步方式（使用asyncio和aiohttp）获取服务器的状态信息（如上行速率、下行速率、连接设备信息等），并利用自定义的信号机制（data_updated_signal）通知主线程更新界面上对应的显示内容，实时展示服务器最新状态。
提供了设置文件保存路径的功能，有下拉框用于选择已保存的路径（最多保存 5 条，可从配置文件config.ini读取并显示），还有 “浏览” 按钮用于打开文件夹选择对话框来新增保存路径，“查看文件夹” 按钮能打开当前选中的保存路径对应的文件夹，同时能将选中的路径设置为特定的上传路径保存到配置文件中。另外，还有一个用于打开设备连接相关窗口的按钮。
设备连接窗口（DeviceConnectionWindow类）：
以对话框形式呈现，会显示本地访问地址（固定为http://127.0.0.1:5000）以及尝试获取的服务器 IP 地址（通过socket模块获取主机名对应的 IP 地址，如果获取失败则显示相应提示），并且针对每个地址都有一个 “复制” 按钮，方便用户复制地址信息到剪贴板。
如果成功获取到服务器 IP 地址，会生成一个对应指向服务器 IP 地址加端口（http://[IP地址]:5000）的二维码并显示在窗口中，便于设备通过扫码进行连接，窗口还有 “关闭” 按钮用于关闭该对话框。
一、整体架构与运行逻辑
基于 PyQt5 构建 GUI 界面：
代码利用了 PyQt5 这个 Python 的 GUI 框架来创建应用程序的可视化界面。通过定义ServerManagerApp类继承自QMainWindow，在__init__方法中设置窗口标题、大小等基础属性，并调用initUI方法来构建整个界面布局，实现了一个包含多个功能区域的主窗口。
利用QVBoxLayout（垂直布局）和QHBoxLayout（水平布局）的组合，细致地划分了界面不同功能模块的位置，例如左侧放置服务器控制和状态相关的组件（如按钮、各类状态显示标签等），右侧用于文件保存路径相关设置（下拉框、按钮等），还有预留的用于展示文件接收进度的表格区域等，整体布局清晰有条理。
服务器管理功能实现：
专门定义了ServerManager类来负责服务器进程的管理。其内部通过subprocess模块实现服务器的启动（在start_server方法中，通过subprocess.Popen运行app.py来启动服务器进程）和停止（在stop_server方法中调用process.terminate终止进程）操作，实现了对后端服务器的基本控制功能。
在ServerManagerApp类的toggle_server方法中，根据服务器当前运行状态（通过server_running变量判断）来调用ServerManager实例相应的启动或停止服务器的方法，并且在操作成功后更新界面上对应显示服务器状态的元素（如按钮文本、样式以及状态标签文本等），实现了服务器状态与界面显示的联动。
异步获取和更新服务器状态机制：
使用aiohttp库实现异步网络请求，在async_get_status方法中，向http://localhost:5000/status接口发送异步GET请求获取服务器状态信息，根据响应状态码以及可能出现的错误情况（如网络错误、JSON 解析错误等）做相应处理，确保能正确获取到有效的服务器状态数据或者合理记录错误信息。
async_update_status方法会在定时器触发时执行（定时器每隔 3 秒调用一次该方法，通过QTimer实现定时功能），先判断服务器是否正在运行，若是则计算运行时长并更新对应界面标签显示，然后调用async_get_status方法获取状态信息，若获取到有效信息则通过自定义的data_updated_signal信号发射出去，通知主线程进行 UI 更新。
主线程中定义了update_ui方法作为data_updated_signal信号的槽函数，用于接收状态信息并更新界面上如上行速率、下行速率、设备信息、连接状态等各相关标签的显示内容，以此实现了服务器状态信息在界面上的实时更新展示。
文件保存路径管理逻辑：
通过configparser模块来读写配置文件（config.ini），实现对文件保存路径相关设置的持久化存储。
load_saved_paths方法用于在程序启动时读取配置文件中已保存的路径列表，去除空字符串后更新界面上路径下拉框（QComboBox）的内容，并设置好上传路径（若不存在则取最新路径），同时绑定下拉框选择事件到save_selected_path_as_upload_path方法，确保用户选择路径后能及时更新配置文件中的上传路径设置。
select_path方法响应 “浏览...” 按钮的点击事件，打开文件夹选择对话框让用户选择新的文件夹路径，然后调用update_and_save_paths方法，该方法会处理路径列表，添加新路径（限制最多保存 5 条路径且去重），更新下拉框内容、设置当前选中路径以及将更新后的路径列表写回配置文件，实现了对文件保存路径的选择、添加和保存功能。
view_selected_folder方法则是响应 “查看文件夹” 按钮点击事件，获取当前下拉框选中的路径后，尝试通过QDesktopServices.openUrl打开对应的文件夹，方便用户查看保存文件的文件夹内容。
设备连接辅助功能：
open_device_connection_window方法响应 “文件上传服务二维码” 按钮点击事件，通过subprocess.Popen尝试运行device_connection.py文件来打开一个用于设备连接的窗口，虽然代码中没有展示该窗口具体功能，但从逻辑上看是为了方便相关设备连接到服务器进行后续操作，比如实现文件上传等功能（可能在device_connection.py中进一步定义相关逻辑）。
二、代码中的关键技术点与细节
信号与槽机制：利用 PyQt5 的信号与槽机制（data_updated_signal信号和对应的update_ui槽函数）实现了异步操作（如获取服务器状态）与主线程 UI 更新的解耦，确保在不阻塞主线程的情况下正确更新界面显示，提升了程序的响应性能和用户体验。
异步编程与网络请求：借助aiohttp库进行异步网络请求，在获取服务器状态时避免了传统同步请求可能导致的阻塞问题，提高了程序在等待网络响应时的效率，尤其是在需要频繁获取服务器状态的场景下，使整个程序运行更加流畅。
配置文件读写与路径管理：通过configparser库读写config.ini配置文件，合理地管理文件保存路径相关信息，实现了保存、加载、更新路径等功能，并且考虑了路径列表的长度限制、去重等细节，保证用户选择的路径能被有效管理和使用。
定时器的运用：使用QTimer定时器，每隔一定时间（代码中设置为 3 秒）触发一次async_update_status方法，定时去获取服务器最新状态并更新界面，让用户能实时看到服务器运行过程中的动态信息变化，无需手动刷新操作。
